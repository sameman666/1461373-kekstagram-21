!function(){"use strict";!function(){const e=document.querySelector(".img-filters"),t=e.querySelector("#filter-random"),o=e.querySelector("#filter-discussed"),n=e.querySelector("#filter-default");window.filter=r=>{e.classList.remove("img-filters--inactive");const c=t=>{e.querySelector(".img-filters__button--active").classList.remove("img-filters__button--active"),t.classList.add("img-filters__button--active")};let i;const d=e=>{i&&window.clearTimeout(i),i=window.setTimeout((()=>{var t;t=e,document.querySelectorAll("a.picture").forEach((e=>e.remove())),window.gallery.renderPhotos(t)}),500)};t.addEventListener("click",(()=>{c(t);const e=[];for(;e.length<10;){const t=(o=r)[Math.floor(Math.random()*o.length)];e.includes(t)||e.push(t)}var o;d(e)})),o.addEventListener("click",(()=>{c(o);const e=r.slice().sort(((e,t)=>t.comments.length-e.comments.length));d(e)})),n.addEventListener("click",(()=>{c(n),d(r)}))}}(),window.load=(e,t,o)=>{const n=new XMLHttpRequest;n.responseType="json",n.addEventListener("load",(()=>{200===n.status?e(n.response):t()})),n.addEventListener("error",(()=>{t("Произошла ошибка соединения")})),n.addEventListener("timeout",(()=>{t("Запрос не успел выполниться за "+n.timeout+"мс")})),n.timeout=7e3,o?(n.open("POST","https://21.javascript.pages.academy/kekstagram"),n.send(o)):(n.open("GET","https://21.javascript.pages.academy/kekstagram/data"),n.send())},function(){const e=document.createDocumentFragment();window.fragment=e;const t=document.querySelector("#picture").content.querySelector("a"),o=document.querySelector(".pictures"),n=e=>{r(e),window.filter(e)},r=n=>{for(let o=0;o<n.length;o++){const r=t.cloneNode(!0);r.querySelector("img").src=n[o].url,r.querySelector(".picture__likes").textContent=n[o].likes,r.querySelector(".picture__comments").textContent=n[o].comments.length,e.appendChild(r)}o.appendChild(e),document.querySelectorAll("a.picture").forEach(((e,t)=>e.addEventListener("click",(()=>{window.preview(n[t])}))))},c=e=>{const t=document.createElement("div");t.style.cssText="z-index: 100; margin: 0 auto; text-align: center; background-color: red; position: absolute; left: 0; right: 0; font-size: 15px",t.textContent=e,document.body.insertAdjacentElement("afterbegin",t)};window.load(n,c),window.gallery={onError:c,onSuccess:n,renderPhotos:r}}(),function(){const e=document.querySelector(".big-picture"),t=document.querySelector(".big-picture__cancel"),o=e.querySelector("img"),n=e.querySelector(".likes-count"),r=e.querySelector(".comments-count"),c=e.querySelector(".social__comments"),i=e.querySelector(".social__comment"),d=e.querySelector(".social__comment-count"),l=e.querySelector(".comments-loader"),s=()=>{e.classList.add("hidden"),document.querySelector("body").classList.remove("modal-open"),document.removeEventListener("keydown",a),l.removeEventListener("click",window.onCommentsLoaderClick)};t.addEventListener("click",(()=>{s()}));const a=e=>{e.preventDefault(),"Escape"===e.key&&s()};window.preview=t=>{e.classList.remove("hidden"),document.querySelector("body").classList.add("modal-open"),d.classList.add("hidden"),o.src=t.url,n.textContent=t.likes,r.textContent=t.comments.length,document.addEventListener("keydown",a),c.innerHTML="";const s=o=>{const n=i.cloneNode(!0),r=n.querySelector("img"),c=n.querySelector(".social__text");e.querySelector(".social__caption").textContent=t.description,r.src=t.comments[o].avatar,r.alt=t.comments[o].name,c.textContent=t.comments[o].message,window.fragment.appendChild(n)},m=Math.min(t.comments.length,5);for(let e=0;e<m;e++)s(e);c.appendChild(window.fragment);let u=5;const w=()=>{l.classList.toggle("hidden",t.comments.length<=u)};window.onCommentsLoaderClick=()=>{if(u<t.comments.length+5){const e=Math.min(u+5,t.comments.length);for(let t=u;t<e;t++)s(t);c.appendChild(window.fragment),u+=5,w()}},w(),l.addEventListener("click",window.onCommentsLoaderClick)}}(),function(){const e="effects__preview--none",t=document.querySelector("#upload-file"),o=document.querySelector(".img-upload__overlay"),n=o.querySelector(".text__hashtags"),r=o.querySelector(".text__description"),c=document.querySelector("#upload-cancel"),i=document.querySelector("#success").content.querySelector(".success"),d=document.querySelector("#error").content.querySelector(".error"),l=document.querySelector("main"),s=document.querySelector(".img-upload__form");t.addEventListener("change",(()=>{o.classList.remove("hidden"),document.querySelector("body").classList.add("modal-open"),document.addEventListener("keydown",a)}));const a=e=>{"Escape"===e.key&&(e.preventDefault(),e.target!==n&&e.target!==r&&m())},m=()=>{o.classList.add("hidden"),document.querySelector("body").classList.remove("modal-open"),h=100,document.removeEventListener("keydown",a),g(),window.applyEffect(e),n.setCustomValidity(""),n.value="",r.value="",t.value=""};c.addEventListener("click",(()=>{m()}));const u=o.querySelector(".scale__control--smaller"),w=o.querySelector(".scale__control--bigger"),f=o.querySelector(".scale__control--value"),v=o.querySelector(".img-upload__preview img"),y=o.querySelector(".img-upload__effect-level"),p=o.querySelector(".effects__list");let h=100;const g=()=>{v.style.transform=`scale(${h/100})`,f.value=h+"%"};u.addEventListener("click",(()=>{h>25&&(h-=25,g())})),w.addEventListener("click",(()=>{h<100&&(h+=25,g())}));const E=e=>{const t=e.cloneNode(!0);l.appendChild(t);const o=t.querySelector(".success__button, .error__button"),n=()=>{document.removeEventListener("keydown",r),document.removeEventListener("click",c)};o.addEventListener("click",(()=>{l.removeChild(t),n()}));const r=e=>{"Escape"===e.key&&(e.preventDefault(),l.removeChild(t),n())},c=e=>{e.target===t&&(l.removeChild(t),n())};document.addEventListener("keydown",r),document.addEventListener("click",c)};s.addEventListener("submit",(e=>{window.load((()=>{m(),E(i)}),(()=>{m(),E(d)}),new FormData(s)),e.preventDefault()})),window.modal={imgEditor:o,hashtagInput:n,DEFAULT_EFFECT:e,imgEditorPreview:v,effectLevel:y,effectsList:p}}(),function(){const e=window.modal.imgEditor.querySelector("#effect-chrome"),t=window.modal.imgEditor.querySelector("#effect-sepia"),o=window.modal.imgEditor.querySelector("#effect-marvin"),n=window.modal.imgEditor.querySelector("#effect-phobos"),r=window.modal.imgEditor.querySelector("#effect-heat"),c=window.modal.imgEditor.querySelector(".effect-level__line"),i=window.modal.imgEditor.querySelector(".effect-level__depth");let d=window.modal.DEFAULT_EFFECT;window.modal.effectLevel.classList.add("hidden");const l=e=>{m(""),u(100),w(100),d!==window.modal.DEFAULT_EFFECT&&window.modal.imgEditorPreview.classList.remove(d),e!==window.modal.DEFAULT_EFFECT&&window.modal.imgEditorPreview.classList.add(e),d=e,window.modal.effectLevel.classList.toggle("hidden",d===window.modal.DEFAULT_EFFECT)};window.modal.effectsList.addEventListener("change",(e=>{l("effects__preview--"+e.target.value)}));const s=window.modal.imgEditor.querySelector(".effect-level__pin"),a=window.modal.imgEditor.querySelector(".effect-level__value"),m=e=>{window.modal.imgEditorPreview.style.filter=e},u=e=>{a.value=e},w=e=>{s.style.left=e+"%",i.style.width=e+"%"};s.addEventListener("mousedown",(i=>{i.preventDefault();let d=i.clientX;const l=i=>{i.preventDefault();const l=d-i.clientX,a=(f=s.offsetLeft-l,100*Math.min(c.offsetWidth,Math.max(0,f))/c.offsetWidth);var f;switch(w(a),d=i.clientX,u(Math.round(a)),!0){case e.checked:m(`grayscale(${a/100})`);break;case t.checked:m(`sepia(${a/100})`);break;case o.checked:m(`invert(${a}%)`);break;case n.checked:m(`blur(${a/100*3}px)`);break;case r.checked:m(`brightness(${2*a/100+1})`)}},a=e=>{e.preventDefault(),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",a)})),window.applyEffect=l}(),function(){const e=/^#[a-zA_Zа-яА-ЯёЁ0-9]{1,19}$/;window.modal.hashtagInput.addEventListener("input",(()=>{const t=window.modal.hashtagInput.value.toLowerCase().trim().split(" "),o=[];if(t.length>5)window.modal.hashtagInput.setCustomValidity("Введите не более 5 хэштегов");else{for(let n=0;n<t.length;n++){if(t[n].length>20){window.modal.hashtagInput.setCustomValidity("Длина хэштега должна быть не более 20 симв.");break}if("#"===t[n]){window.modal.hashtagInput.setCustomValidity("Хэштег не может состоять только из решетки");break}if("#"!==t[n][0]){window.modal.hashtagInput.setCustomValidity("Хэштег должен начинаться с решетки");break}if(!e.test(t[n])){window.modal.hashtagInput.setCustomValidity("Хэштег должен содержать только буквы и цифры");break}if(o.includes(t[n])){window.modal.hashtagInput.setCustomValidity("Хэштег не должен повторяться");break}o.push(t[n]),window.modal.hashtagInput.setCustomValidity("")}window.modal.hashtagInput.reportValidity()}}))}()}();